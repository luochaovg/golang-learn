#### 字节后台二面
- https://www.nowcoder.com/discuss/615929?type=2&channel=-1&source_id=discuss_terminal_discuss_hot_nctrack


##### 说一下项目中用到的redis分布式锁
- [参考](https://segmentfault.com/a/1190000037798450)
- [参考](https://www.infoq.cn/article/dvaaj71f4fbqsxmgvdce)
```text
三种实现方式
常见分布式锁一般有三种实现方式：1. 数据库锁；2. 基于ZooKeeper的分布式锁；3. 基于Redis的分布式锁。

数据库锁：这种方式很容易被想到，把竞争的资源放到数据库中，利用数据库锁来实现资源竞争，可以参考之前的文章《数据库事务和锁》。例如：（1）悲观锁实现：查询库存商品的sql可以加上 "FOR UPDATE" 以实现排他锁，并且将“查询库存”和“减库存”打包成一个事务 COMMIT，在A用户查询和购买完成之前，B用户的请求都会被阻塞住。（2）乐观锁实现：在库存表中加上版本号字段来控制。或者更简单的实现是，当每次购买完成后发现库存小于零了，回滚事务即可。
zookeeper的分布式锁：实现分布式锁，ZooKeeper是专业的。它类似于一个文件系统，通过多系统竞争文件系统上的文件资源，起到分布式锁的作用。具体的实现方式，请参考之前的文章《zookeeper的开发应用》。
redis的分布式锁：之前的文章讲过redis的开发应用和事务，一直没有讲过redis的分布式锁，这也是本文的核心内容。简单来说是通过setnx竞争键的值。

“数据库锁”是竞争表级资源或行级资源，“zookeeper锁”是竞争文件资源，“redis锁”是为了竞争键值资源。它们都是通过竞争程序外的共享资源，来实现分布式锁。

1，lua + setnx + expire 加锁， 但是两个不是原子操作 ： 这样实现的分布式锁仍然存在一个严重的问题，由于 SETNX 和 EXPIRE 这两个操作是非原子性的， 如果进程在执行 SETNX 和 EXPIRE 之间发生异常，SETNX 执行成功，但 EXPIRE 没有执行，导致这把锁变得“长生不老”
2，使用 SET 扩展指令 ， set key value NX EX 10 : 仍然不能彻底解决分布式锁超时问题：锁被提前释放/锁被误删
3, Redisson 的分布式锁
单实例原子性非常重要

4，Redis 多机实现的分布式锁 Redlock
```

##### 4. redis集群模式下的RedLock分布式锁算法
- [参考](https://zhuanlan.zhihu.com/p/40915772)
- [参考](https://www.cnblogs.com/rgcLOVEyaya/p/RGC_LOVE_YAYA_1003days.html)
- [参考](https://zhuanlan.zhihu.com/p/44073906)
```text
算法很易懂，起 5 个 master 节点，分布在不同的机房尽量保证可用性。为了获得锁，client 会进行如下操作：

1，得到当前的时间，微妙单位
2，尝试顺序地在 5 个实例上申请锁，当然需要使用相同的 key 和 random value，这里一个 client 需要合理设置与 master 节点沟通的 timeout 大小，避免长时间和一个 fail 了的节点浪费时间
3，当 client 在大于等于 3 个 master 上成功申请到锁的时候，且它会计算申请锁消耗了多少时间，这部分消耗的时间采用获得锁的当下时间减去第一步获得的时间戳得到，如果锁的持续时长（lock validity time）比流逝的时间多的话，那么锁就真正获取到了。
4，如果锁申请到了，那么锁真正的 lock validity time 应该是 origin（lock validity time） - 申请锁期间流逝的时间
5，如果 client 申请锁失败了，那么它就会在少部分申请成功锁的 master 节点上执行释放锁的操作，重置状态

```

##### 5. 项目中设置的分布式锁超时时间是多少
```text

500ms拿不到锁, 就认为获取锁失败。10000ms即10s是锁失效时间。
```

##### 客户端拿到分布式锁后锁超时被redis过期了，客户端释放锁时怎么处理（比较锁的value是否和当初自己设置的value相等）

##### 客户端释放分布式锁失败后，需要进行什么处理

##### 怎么实现redis分布式锁的重入（回答了在设置value的时候，设置value为当前机器id+线程id+重入次数）

##### RedLock算法下，如果各有一半的锁分别被两个客户端获取了，怎么处理

##### 说一下项目中怎么用到消息队列

##### 使用RabbitMQ会遇到什么问题吗（我说有可能会遇到消息丢失的情况）

##### 怎么解决RabbitMQ消息丢失

##### RabbitMQ在生产者确认消息到达后，如果还没把消息写入磁盘就挂了，怎么解决这种情况的消息丢失？

##### 需要严格顺序消费的消息和不需要严格顺序的消息，遇到了消息堆积的处理方法

##### 怎么提高消费者消费速度

##### 说一下自己对MySQL的理解（主要说了MVCC怎么解决读写锁互斥的问题）

##### 说一下MySQL主从复制原理

##### 平时使用Docker的场景

##### 了解Docker的资源隔离原理吗（只知道是用了Linux的某个特性）

##### 说一下项目用到了哪些微服务组件

##### 为什么要使用微服务

##### 服务调用失败怎么解决（失败重试机制，服务降级）

##### 调用失败什么情况下进行重试，什么情况进行降级（接口是否幂等性）

##### 什么样的接口是幂等性的，什么不是（读操作的大部分是幂等性，写操作大部分非幂等性）

##### 怎么样让写操作的接口实现幂等性


##### 二叉树中序遍历，要用迭代

##### 判断集合相等，回答了用哈希表的方法，时间复杂度O(n)，空间复杂度O(n)，面试官问能不能降低空间复杂度。想不出来，后面面试官说可以参照布隆过滤器的算法来实现。

##### 说一下RabbitMQ和Kafak的区别（说了RabbitMQ的集群模式和Kafak的集群模式，Kafak有RabbitMQ没有的扩展性）

##### elasticsearch的集群模式

##### es搜索为什么比mysql快

##### es查询数据的流程

##### 如果在mysql有索引的情况下，根据索引查询，mysql和es谁比较快


##### 输入网址到显示页面发生了什么

##### 说一下SSL连接流程

##### 为什么一开始用非对称加密，后面使用对称加密

##### 场景题：面对大量的IO密集型任务，怎么设置线程池参数来保证最大吞吐量

##### 使用hashmap时，如果要放入一亿个数据，怎么设置初始容量

##### 思考题：两根不均匀的香，燃烧时间都为一个小时，怎么取得15分钟


#####
```text
问redis，单线程redis优势原因
redis淘汰机制
redis持久化，rdb和aof区别，各自怎么实现持久化的
数据库，索引失效的情况
MQ，项目中怎么打算用，具体逻辑思路
算法题：k个一组翻转链表 https://leetcode-cn.com/problems/reverse-nodes-in-k-group/
算法题：求环形链表的入口节点，一个链表是否有环 （快慢指针）
```